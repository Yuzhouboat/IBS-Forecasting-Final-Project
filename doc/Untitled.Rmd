---
title: "Enhanced GARCH Model for SP500 Volatility"
author: "Yuzhou Liu, Qinghan Shen, Yukun Xia, Zihao Song, Jiaren Ma"
date: "12/8/2018"
output:
  word_document: default
  pdf_document: default
subtitle: ECON/FIN250A Final Project
---
#Topic Introduction
Nowadays, volatility is widely used as a prime perimeter for financial risk management. Risk parity funds tend to hedge their exposure using derivatives when the market volatility exceeds some certain levels. The traditional GARCH model for volatility forecasting implies that Volatility will risk after a large movement in markets regardless of the direction of the movement. However, market experiences show that VIX index, which is calculated using the IV of index option, tend to rise when market crushes, and decrease when market rises. This phenomenon could be explained by the leverage effect, and our goal is to add the leverage effect to the traditional model and test whether our model is more accurate in forecasting the real volatility of the market for the period than the traditional GARCH model and the VIX index. 

```{r pressure, echo=FALSE, fig.cap="Source: Yahoo Finance", out.width = '100%'}
knitr::include_graphics("../lib/vol&sp500.png")
```

```{r, echo=FALSE, message=FALSE}
#Packages needed
library(forecast)
library(zoo)
library(plyr)
library(urca)
library(rugarch)
```

#Data Description
First, we use the daily open and close quote for S&P500 ETF from yahoo finance to generate the SP500 return time series. The plot of data is as follows. From the graph, we can see there is no obvious trend or seasonality. 

Second, we use the daily realized volatility SP500 data from Oxford-Man institute of quantitative Finance library to get the realized volatility of SP500 from 2000.

Finally, we use the daily open and close data of VIX index from yahoo finance to get the market implied volatility of the SP500 index. 

```{r, echo=FALSE}
#Load Data
SP500.raw <- read.csv("../data/S&P500.csv")
VIX.raw <- read.csv("../data/Vix.csv")
ReVol.raw <- read.csv("../data/RealizedVol.csv")
```

#Data Preprocessing
asdkjfhakjsdhf
adsfouasoidfuioasudoifasd
adskfjhasdjkfads
```{r, echo=FALSE}
#Relized Volatility time series
ReVol.df <- ReVol.raw[-(1:2),1:2]
colnames(ReVol.df) <- c("Date", "Vol")
ReVol.df$Date <- as.Date(ReVol.df$Date, format = "%Y%m%d")
ReVol.df$Vol <- sqrt(as.numeric(as.character(ReVol.df$Vol)))
ReVol.df<- ReVol.df[!is.na(ReVol.df$Vol),]
ReVol.ts <- zoo(ReVol.df$Vol, ReVol.df$Date)

#SP500 Close Price time series
dates.sp <- as.Date(SP500.raw$Date,format="%Y-%m-%d")
SP500.ts <- zoo(SP500.raw$Adj.Close,dates.sp)

# SP500 Return time series
SPret.ts <- diff(log(SP500.ts))

# Vix Index time series
dates.vix <- as.Date(VIX.raw$Date,format="%Y-%m-%d")
VIX.ts <- zoo(VIX.raw$Adj.Close,dates.vix)

# Align all Time Series 
startdate <- time(ReVol.ts)[1]
SPret.ts <- window(SPret.ts, start = startdate)
VIX.ts <- window(VIX.ts, start = startdate)
```

#Relized Volatility Forecasting
###Basic check for Relized Vol series
&&&1 The seasonal and trend or stationary from its plot?
```{r, echo=FALSE, dpi=300, fig.width=10, fig.height=7}
plot(ReVol.ts, ylim = c(0,0.06), cex.lab = 1.5, cex.main = 2,
     main = "SP500 Daily Realized Volatility (5-min Sub-sampled)",
     xlab = "Years",
     ylab = "Realized Volatility (Standard Deviation)")
```

&&&2 Unit Root Test check stationary?
```{r, echo=FALSE}
#Unit Root Test
ReVol.ur <- ur.df(ReVol.ts, type = "none", selectlags="BIC")
ReVol.ur
print("Critical Value Table")
summary(ReVol.ur)@cval
```

&&&3 ACF and PACF ?
&&&4 ACF and PACF ?
```{r, echo=FALSE, dpi=300, fig.width=10, fig.height=7}
#ACF
Acf(as.numeric(ReVol.ts), cex.lab = 1.5, cex.main = 3, 
    main = "Autocorrelation Plot of SP500 Realized Vol")
#Pacf
Pacf(as.numeric(ReVol.ts),  cex.lab = 1.5, cex.main = 3,
     main = "Partial Autocorrelation Plot of SP500 Realized Vol")
```